{% extends "base.html" %}

{% load bookingtags static %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'booking/css/vanilla-notify.css' %}">
<script type='text/javascript' src="{% static 'booking/js/vanilla-notify.min.js' %}"></script>

<script type="text/javascript">
    window.CSRF_TOKEN = "{{ csrf_token }}";
</script>
{% endblock %}

{% block content %}
<div class="container">
    <h1 class="mt-3">Block Purchase Options</h1>
        {% if related_item %}<h2>for {{ related_item }}</h2>{% endif %}
      <div class="mb-2">
          <a class="btn btn-info btn-xs" href="{% url 'booking:shopping_basket' %}"><span>View cart <i class="fas fa-shopping-cart"></i></span></a>
      </div>

        <table class="table table-sm">
              <thead>
                <th style="width: 75%"></th>
                <th style="width: 10%"></th>
                <th style="width: 15%"></th>
              </thead>
              <tbody>
                {% for title, blocklist in available_blocks.items %}
                    <tr class="table-secondary">
                        <td class="pl-2">{{ title }}</td>
                        <td class="text-center">User</td>
                        <td></td>
                    </tr>
                    {% for available_block_config in blocklist %}
                    <tr {% if available_block_config in target_configs %}class="table-success"{% endif %}>
                        <td class="pl-2">
                            <p>{{ available_block_config }}</p>
                            <p>{% if available_block_config.description %}{{ available_block_config.description }}{% endif %}</p>
                            <p>Â£{{ available_block_config.cost }} |
                                {% if available_block_config.duration %} Expires after {{ available_block_config.duration }} weeks{% else %}Never expires {% endif %} |
                                {{ available_block_config.size }} uses </p>
                            <p>
                                {% active_block_info user_active_blocks available_block_config %}
                            </p>
                        </td>
                        <td>
                            {% for available_user in available_users %}
                            <div class="block_purchase_btn ">
                                <span class="badge badge-pill badge-light float-right mt-2"><span class="helptext">{{ available_user.first_name }} {{ available_user.last_name }}</span></span><br/>
                            </div>
                            {% endfor %}
                        </td>
                        <td class="table-purchase-td">
                            {% for available_user in available_users %}
                            <span
                                id="block_config_{{ available_block_config.id }}_{{ available_user.id }}"
                                data-user_id="{{ available_user.id }}"
                                data-block_config_id="{{ available_block_config.id }}"
                                data-block_config_type="{% if available_block_config.course_type %}course{% else %}dropin{% endif %}"
                                class="float-right ajax_blocks_btn">
                                {% include "booking/includes/blocks_button.txt" %}
                            </span><br/>
                            {% endfor %}
                        </td>
                    </tr>
                    {% endfor %}
                {% endfor %}
              </tbody>
         </table>
    </div>

{% endblock content %}


{% block extra_js %}
<script type='text/javascript' src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
<script type='text/javascript' src="{% static 'booking/js/events_blocks_ajax-v1.js' %}"></script>
{% endblock %}